<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <style type="text/css">
      pre {
        margin: 10px;
        padding: 10px;
        border: 1px solid #9C9898;
        -webkit-box-shadow: 0 0 8px rgba(0, 0, 0, 0.3);
        -moz-box-shadow: 0 0 8px rgba(0, 0, 0, 0.3);
        list-style: none;
      }
    </style>
    <script type="text/javascript">
var APIKEYS = {
  __proto__: undefined,
  257: "sTyBGlV-LsQcI8mhMYI3nvqtkYvVoERMb-mz8yhhgCU",
  258: "HTa1l-uc9TjOKITyqipRnpGIpvKHDx4iJnpzw2Avh34",
  259: "lJViHIk38u6398pxI7pktLmgg3FdE7gDER0Xc866PEY",
  260: "uaTEcZQKdeET6CN6nuYHpgu1s7xBvWP_SBCp_VtOABY",
  261: "Du9L8dk9JLDdb7SHk9XYN1Ak-dntk1o7cF2wxuqDRO4",
  262: "W1C-NaULW1_8nHNNT8bgO1iVZQw0Y5E5xS0rx0Ai6yU",
  263: "vT40nPN69h7_wsIDGTF-4Gcttvf4rQuchgSzc927r7Q",
  264: "WtflyfeoCEYOO6cxfWVd6b7P29HEDK_6cWmY7NymCT0",
  265: "pNQ8MX8r-qAAqgQF9CT5oENcEesclZsxLV_oWvocSXw",
  266: "flFbCfMUcqqY8lo39hAsvy06UzfE3lyEtYGgBNjMjp0",
  268: "diDmneVtS1zxQsOOvbMxOwj0SGyP9DoXhhWUTZKC5Bs",
  269: "2TMeQO4q3ZcQArKkCpuPblBaysh9H_cC-fVPwqSoZE0",
  270: "tw1zCB0gL40UCe2gDhXKyTKBKDlJ33gn7FHUJj20dco",
  271: "Ae4kr_a4GiLn1cI7ryPQ3QruGzJmcPX8WoaH6wM3H0Q",
  272: "hoGvSV1nfHFfd_7BVvI0zXpiY9Vad6oGHceuPBxxztk",
  273: "ORo-bn_FH4bJqFjvjPDkeW2Z2MXy8_Dp64ZLi9OEbac",
  274: "OXcagDNWVmI3WODEo8Hin30-uBS23Le-KCnR2TDdv7A",
  275: "p3PIHn3qkcR7GnZjNXWzaKUR9F5FEwSFhsfC6M9__yQ",
  276: "x0WbJl_MLrD1wGyMVjdLNY0rcfkamn-T_t2uOKWKCZU",
  277: "QiVeDK2u8crkoPIQ80fZeyA4qNN3hFe0XpyQl9xTYPA",
  278: "3yDZE9oui5k50oU-wirhDoWW3XDAub7yHaU3-eVnvL0",
  279: "mH63vwaR-d1f_uSUSwPeFCL9mTQDGwT4uoT6tFOlYVg",
  280: "DuF2DQX_Sjd4_dJnYeai5pOvkU8lnVMBlHUodD0gW7A",
  281: "qZAAhAtiG0-nVEa6zw4LcfUdtWUaHZt8tNgjOLZd1j8",
  282: "80YyewGGsc6_U7EtSuezMuLiblCpZOEMkYxmnt5tz08",
  283: "Ii06qkxGXHYcDHurYBzbAfNSMDCnRvslinglIhEz1n0",
  284: "brkjyNl-Fln6DUC5kHRmI2uF0zt-5rPc8aFRTEO4sPo",
  285: "Gko1rgpT9JZ0FY4d48u0hnoIw_9v6RihxpFaIVweFoA",
  286: "SBC0hOTY-ckcMLIyWHR7WQsvpKqh7vknlZdxx7J_Vuo",
  287: "mYbl9cOMjpwluol3MT91EMPZCgisb-t7tk-6azPgzOg",
  288: "6Xt5J5qWi1hmL9j7FCbbnrDttsYohw8w26t1kP0c17Y",
  289: "D8LZZxZJX52St2go-EldrLpN1uewcbshJPP79D6mKUE",
  290: "yapp17WHUUW0A8h1ppsJcX3meUSKS7yiZu75KychPb8",
  291: "0RzNqEhR22-b8eIdL_se21MGxAa0__iqjjYkOrWPDuU",
  292: "YdqNEOjWysj-KWo6SigebU9Lf6skabc-D1LGg6Ag-QY",
  293: "iVIixg9sgfy45gA_hgA0jbCxPZfy42kaMq9bayBKerg",
  294: "9CCHB1-Mj8ejiJjy2XHtx4gsaMgWWFeSdKUzBr1fsH0",
  295: "cxAmvKwR9Ah1b0lhyGaDlBESqrvrgjZPWlDKaPWF3yE",
  296: "BF-kvJkBD519FPNmCNZh9OSwomgRMmhWEZt9rQhrb3I",
  297: "UMg8vVk2NrBI3-MQAOMZmxl9i82ARPeCKe6B8oIWZFc",
  298: "h3dAsDZ3-uBbz8khpd0M_AcMjxugToGm8Oi448spGmE",
  299: "0iBvs33fc_bFdY5uZj_KsE454GNwbq5ZWoTF3uhqeNw",
  300: "3Yrcm-pNZ2hGJyx4xqMv96YLMrA9KaVtqXVmoZJyobw",
  301: "DBhYnQsgwHTcg5lz5QSm99AqvQcLp48SehwEfBEezxw",
  302: "rLbWcbHi79qz0Pad4jdw0y9igQUo67vD59cTPdr1Kc4",
  303: "NCGtJRfSxiNfadiFc0YLPglX0THpXEIQWGq6qbZgGGU",
  304: "MzC3vJg-vUYeEBv0wZ2wJOjs_Y30QFXD9RxOuDTm_8s",
  306: "LQiVYd7rPXkHnLJNxozuvKVyG-JZigvu3Q83u_r6qxA",
  307: "T_wz-RrNEDt_bTLgQlLkhh8vNfFRVrw8_PWudjkq2pM",
  308: "V4hG4MKPWCXLnWH2RvobCsd8fQBKr3L9qSAy_mG3zA4",
  309: "zO9ydbzaNZOfiADx9N1gs1xm_hwS8S2CfKGn9kFvj1g"
};

var ws,
    clients=[],
    log_obj,
    received_messages = [],
    last_display = 0,
    start_obj,
    log_timer,
    opened,
    max_obj;

function log(message) {
  log_obj.innerHTML += message + "\n";
}

function startBench() {
  received_messages = [];
  last_display = 0;
  opened = 0;
  
  var max = +max_obj.value;
  
  if (log_timer) {
    clearInterval(log_timer);
    log_obj.innerHTML = "";
  }

  log("starting bench script...");

  while(clients.length > 0) {
    clients.shift().close();
  }

  for(var user_id in APIKEYS) {
    ws = new WebSocket("ws://web03.m.xenzai.com:3123/" + APIKEYS[user_id] + "/");
    //ws = new WebSocket("ws://web03.m.xenzai.com:3123/" + APIKEYS[user_id] + "/?fields=time,val&tags=cpu,user,7,aaa");
    
    ws.onmessage = function(e) {
      received_messages.push(e.data);
    };
    
    ws.onopen = function() {
      opened++;
    };
    
    clients.push(ws);
    
    if (clients.length >= max) {
      break;
    }
  }
  
  log_timer = setInterval(function() {
    var len = received_messages.length;
    if (last_display !== received_messages.length) {
      log("[number of received messages] conn:" + opened + ", total: " + len + ", increase:" + (len - last_display));
      last_display = received_messages.length;
    }
  }, 1000);
};

function onLoad() {
  log_obj = document.getElementById("log");
  start_obj = document.getElementById("start");
  max_obj = document.getElementById("max");
  start_obj.addEventListener("click", startBench);
}

window.addEventListener("load", onLoad, false);

    </script>
  </head>
  <body>
     <label><b>MAX: </b><input id="max" value="50" /></label>
     <button id="start">start</button>
    <pre id="log"></pre>
  </body>
</html>